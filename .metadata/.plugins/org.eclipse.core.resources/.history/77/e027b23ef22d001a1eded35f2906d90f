package com.shubham.stockReport;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.Iterator;
import java.util.Set;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

public class StockManagement {
public static void main(String[] args) throws IOException, ParseException {
	
	/*Reading File Using FileReader*/
	FileReader file=new FileReader("C:/Users/User/Desktop/final/programming/src/com/shubham/stockReport/companyStocks.JSON");
	
	JSONParser parser=new JSONParser();
	Object object=parser.parse(file);
	
	/*We will use this JSONObject rootObject*/
	JSONObject rootObject=(JSONObject)object;
	
	/*Created Buffered Reader Object*/
	BufferedReader br=new BufferedReader(new InputStreamReader(System.in));
	
	/*Creating Object of StockValues Class*/
	StockValues stockValue=new StockValues();
	
	/*Creating Object of CostumerDetails Class*/
	CostumerDetails costumerDetails =new CostumerDetails();
	
	/*objects for finding present or todays date*/
	DateFormat dateFormat = new SimpleDateFormat("MM/dd/yyyy HH:mm:ss");
	Date today = Calendar.getInstance().getTime();
	
	/*We will create a JSONObject rootObject for purchased Stocks*/
	JSONObject rootPurchaseObject=new JSONObject();
	
	//addStock(rootObject,Id, br, stockValue);
	purchaseStock(rootObject, br, costumerDetails, dateFormat, today, rootPurchaseObject);
	 generatePurchaseList(rootObject, rootPurchaseObject, br);
}

/*This function will add new Stock values*/
public static void addStock(JSONObject rootObject,String Id,BufferedReader br,StockValues stockValue) throws IOException
{
	String actualId="Shubham Pandey";
	String companyName;
	if(actualId.equals(Id))
	{
		System.out.println("Enter the following details");
		System.out.println();
		System.out.println("Enter Company Name");
		companyName=br.readLine();
		System.out.println("Enter Stock Name");
		stockValue.setStockNames(br.readLine());
		System.out.println("Enter Number Of Shares");
		stockValue.setNumberOfShares(br.readLine());
		System.out.println("Enter Share Price");
		stockValue.setSharePrice(br.readLine());
	}
	else
	{
		System.out.println("Authentication Failed");
		return;
	}
	JSONObject newObject=new JSONObject();
	newObject.put("stockNames", stockValue.getStockNames());
	newObject.put("numberOfShares", stockValue.getNumberOfShares());
	newObject.put("sharePrice", stockValue.getSharePrice());
	rootObject.put(companyName,newObject);
	System.out.println(rootObject.toJSONString());
}

/*This function will manage all the transaction records*/
public static void purchaseStock(JSONObject rootObject,BufferedReader br,CostumerDetails costumerDetails,DateFormat dateFormat,Date today,JSONObject rootPurchaseObject) throws IOException
{
	System.out.println("Enter Company Stock you want to purchase");
	String companyName=br.readLine();
	
	/*Calling a function asking for Costumer Details*/
	costumerDetails(br, costumerDetails, dateFormat, today);
	
	/*Getting the specified Object for the Entered Company*/
	JSONObject object=(JSONObject) rootObject.get(companyName);
	System.out.println("How much stock you want to purchase");
	String stockNumber=br.readLine();
	String actualStockNumber=(String)object.get("numberOfShares");
	
	/*root object updated after stock is purchased*/
	if(Integer.parseInt(actualStockNumber)>=Integer.parseInt(stockNumber))
	{
		int updatedStock=Integer.parseInt(actualStockNumber)-Integer.parseInt(stockNumber);
		object.put("numberOfShares",updatedStock+"");
	}
	else
		System.out.println("Stocks Sold Out Wait For The Next Updation");
	
	/*logic is to create new JSONObject for purchased stock details*/
	JSONObject newObject=new JSONObject();
	newObject.put("name", costumerDetails.getFullName());
	newObject.put("age", costumerDetails.getAge());
	newObject.put("phoneNumber", costumerDetails.getPhoneNumber());
	newObject.put("nameOfCompany", companyName);
	newObject.put("numberOfStock", stockNumber);
	
	JSONArray array=new JSONArray();
	array.add(newObject);
	
	/*Putting all into our new JSONObject rootPurchaseObject*/
	rootPurchaseObject.put(costumerDetails.getCurrentDate(), array);
	System.out.println(rootPurchaseObject.toJSONString());
}

/*This function will ask for Costumer Details*/
public static void costumerDetails(BufferedReader br,CostumerDetails costumerDetails,DateFormat dateFormat,Date today) throws IOException
{
	System.out.println("Enter your full name:");
	costumerDetails.setFullName(br.readLine());
	System.out.println("Enter your age");
	costumerDetails.setAge(Integer.parseInt(br.readLine()));
	System.out.println("Enter your phone Number");
	costumerDetails.setPhoneNumber(Long.parseLong(br.readLine()));
	String currentDate = dateFormat.format(today);
	costumerDetails.setCurrentDate(currentDate);
}

/*This function will generate list what costumer want to see*/
public static void generatePurchaseList(JSONObject rootObject,JSONObject rootPurchaseObject,BufferedReader br) throws IOException
{
	System.out.println("Enter what you want");
	String demand=br.readLine();
	
	if(demand.equals("date"))
	{
		System.out.println("The following purchase stock dates");
		Set<String> keys=rootPurchaseObject.keySet();
		Iterator iterator=keys.iterator();
		while(iterator.hasNext())
		{
			System.out.println("  "+iterator.next());
		}
	}
	System.out.println("Enter which date and time you want the details:");
	String details=br.readLine();
	/*showing details in mailing format*/
	JSONObject object=(JSONObject) rootPurchaseObject.get(details);
	Set<String> keys=object.keySet();
	Iterator iterator=keys.iterator();
	while(iterator.hasNext())
	{
		int index=1;
		String keyValue=(String) iterator.next();
		System.out.println(index+"--"+keyValue);
		String value=(String) object.get(keyValue);
		System.out.println("   "+value);
		System.out.println();
	}
	
}
}
